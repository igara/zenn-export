
<style>
.znc{line-height:1.9}.znc>*:first-child{margin-top:0}.znc i,.znc cite,.znc em{font-style:italic}.znc strong{font-weight:700}.znc a{color:#0f83fd}.znc a:hover{text-decoration:underline}.znc p+p{margin-top:1.5em}.znc ul,.znc ol{margin:1.4rem 0;line-height:1.7}.znc ul>li,.znc ol>li{margin:.4rem 0}.znc ul ul,.znc ul ol,.znc ol ul,.znc ol ol{margin:.2em 0}.znc ul p,.znc ol p{margin:0}.znc ul{padding-left:1.8em}.znc ul>li{list-style:disc}.znc ul>li::marker{font-size:1.1em;color:#5e6478}.znc ol{padding-left:1.7em}.znc ol>li{list-style:decimal;padding-left:.2em}.znc ol>li::marker{color:#535872;font-weight:600;letter-spacing:-0.05em}.znc .contains-task-list li{list-style:none !important}.znc .task-list-item-checkbox{margin-left:-1.5em;font-size:1em;pointer-events:none}.znc h1+p,.znc h2+p,.znc h3+p,.znc h4+p,.znc h5+p,.znc h6+p{margin-top:.3em}.znc h1,.znc h2{margin-top:2.3em;margin-bottom:.5em}.znc h3,.znc h4,.znc h5,.znc h6{margin-top:2.25em;margin-bottom:.5em}.znc h1{padding-bottom:.2em;margin-bottom:1.1rem;font-size:1.7em;position:relative;border-bottom:solid 1px rgba(92,147,187,.17)}.znc h2{font-size:1.5em}.znc h3{font-size:1.3em}.znc h4{font-size:1.1em}.znc h5{font-size:1em}.znc h6{font-size:.9em}@media screen and (max-width: 576px){.znc h1{font-size:1.6em}.znc h2{font-size:1.4em}.znc h3{font-size:1.2em}.znc h4{font-size:1.1em}.znc h5{font-size:1em}.znc h6{font-size:.85em}}.znc hr{border-top:2px solid rgba(92,147,187,.17);margin:2.5rem 0}.znc blockquote{font-size:.97em;margin:1.4rem 0;border-left:solid 3px #9dacb7;padding:2px 0 2px .7em;color:#505c64}.znc blockquote p{margin:1rem 0}.znc blockquote>:first-child{margin-top:0}.znc blockquote>:last-child{margin-bottom:0}.znc blockquote.twitter-tweet{display:none}.znc table{margin:1.2rem auto;width:auto;border-collapse:collapse;font-size:.95em;line-height:1.5;word-break:normal;display:block;overflow:auto;-webkit-overflow-scrolling:touch}.znc th,.znc td{padding:.5rem;border:solid 1px #cfdce6;background:#fff}.znc th{font-weight:700;background:#edf2f7}.znc code{padding:.2em .4em;background:rgba(33,90,160,.07);font-size:.85em;border-radius:4px;vertical-align:.08em}.znc code,.znc .code-block-filename{font-family:"SFMono-Regular",Consolas,"Liberation Mono",Menlo,monospace,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";-webkit-font-smoothing:antialiased}.znc pre{margin:1.3rem 0;background:#1a2638;overflow-x:auto;-webkit-overflow-scrolling:touch;border-radius:.7em;box-shadow:0 4px 6px -1px rgba(0,14,30,.15);word-break:normal;word-wrap:normal;display:flex}.znc pre:after{content:"";width:8px;flex-shrink:0}.znc pre code{margin:0;padding:0;background:transparent;font-size:.9em;color:#fff}.znc pre>code{display:block;padding:1.1rem}@media screen and (max-width: 576px){.znc pre>code{padding:1rem .8rem;font-size:.85em}}.znc .code-block-container{position:relative;margin:1.3rem 0}.znc .code-block-container pre{margin:0}.znc .code-block-filename{display:table;max-width:100%;background:#323e52;color:rgba(255,255,255,.9);font-size:12px;line-height:1.3;border-radius:6px 6px 0 0;padding:6px 12px 20px;margin-bottom:-16px}.znc .code-block-filename-container+pre{border-top-left-radius:0}.znc img:not(.emoji){margin:1.5rem auto;display:table;max-width:100%;height:auto}.znc img+br{display:none}.znc img~em{display:block;margin:-1rem auto 0;line-height:1.3;text-align:center;color:#77838c;font-size:.92em}.znc details{font-size:.95em;margin:1rem 0;line-height:1.7}.znc summary{cursor:pointer;outline:0;padding:.7em .7em .7em .9em;border:solid 1px rgba(92,147,187,.19);color:var(--c-contrast);font-size:.9em;border-radius:9px;box-shadow:0 2px 4px -2px rgba(0,0,0,.15)}.znc summary::-webkit-details-marker{color:#77838c}.znc details[open] summary{border-radius:5px 5px 0 0;box-shadow:none;background:#f1f5f9;border-bottom:none}.znc .details-content{padding:.5em .9em;border:solid 1px rgba(92,147,187,.2);border-radius:0 0 5px 5px}.znc .details-content>*{margin:.5em 0}.znc .embed-tweet,.znc .embed-gist,.znc .embed-speakerdeck,.znc .embed-slideshare,.znc .embed-codepen,.znc .embed-jsfiddle,.znc .embed-youtube,.znc .embed-codesandbox,.znc .embed-stackblitz,.znc .embed-mermaid{margin:1.5rem 0}.znc .embed-slideshare,.znc .embed-speakerdeck,.znc .embed-codepen,.znc .embed-jsfiddle,.znc .embed-youtube,.znc .embed-stackblitz{padding-bottom:calc(56.25% + 38px);position:relative;width:100%;height:0}.znc .embed-slideshare iframe,.znc .embed-speakerdeck iframe,.znc .embed-codepen iframe,.znc .embed-jsfiddle iframe,.znc .embed-youtube iframe,.znc .embed-stackblitz iframe{position:absolute;top:0;left:0;width:100%;height:100%;border:none}.znc .embed-slideshare iframe{border:1px solid #1a2638}.znc .embed-zenn-link{margin:1rem auto}.znc .embed-zenn-link iframe{height:125px;width:100%;display:block}.znc embed-katex:not([display-mode="1"]){display:inline-flex;overflow-x:auto;max-width:100%;-ms-overflow-style:none;scrollbar-width:none}.znc embed-katex:not([display-mode="1"])::-webkit-scrollbar{display:none}.znc embed-katex[display-mode="1"]{display:block;width:100%;overflow-x:auto}.znc embed-mermaid svg{height:auto}.znc pre.zenn-mermaid{background:transparent;color:#93a5b1;font-size:.9rem}.znc pre[class*=language-]{position:relative}.znc .token.namespace{opacity:.7}.znc .token.comment,.znc .token.prolog,.znc .token.doctype,.znc .token.cdata{color:#94a1b3}.znc .token.operator,.znc .token.boolean,.znc .token.number{color:#ffc56d}.znc .token.attr-name,.znc .token.string{color:#ffc56d}.znc .token.entity,.znc .token.url,.znc .language-css .token.string,.znc .style .token.string{color:#ffc56d}.znc .token.selector{color:#ff8fa3}.znc .token.atrule,.znc .token.attr-value,.znc .token.keyword,.znc .token.important{color:#ff8fa3}.znc .token.deleted{color:#ff8fa3}.znc .token.inserted{color:#b4ff9b}.znc .token.deleted:not(.prefix){background:rgba(218,54,50,.2);color:inherit;display:block}.znc .token.prefix{user-select:none}.znc .token.inserted:not(.prefix){background:rgba(0,146,27,.2);color:inherit;display:block}.znc .token.prefix.unchanged{display:none}.znc .token.unchanged>.token.prefix.unchanged{display:inline}.znc .token.coord{color:#aad4ff}.znc .token.regex,.znc .token.statement{color:#ffc56d}.znc .token.placeholder,.znc .token.variable{color:#fff}.znc .token.important,.znc .token.statement,.znc .token.bold{font-weight:700}.znc .token.punctuation{color:#939bc1}.znc .token.entity{cursor:help}.znc .token.italic{font-style:italic}.znc .token.tag,.znc .token.property,.znc .token.function{color:#38c7ff}.znc .token.attr-name{color:#ff8fa3}.znc .token.attr-value{color:#ffc56d}.znc .token.style,.znc .token.script{color:#ffc56d}.znc .token.script .token.keyword{color:#ffc56d}.znc aside.msg{display:flex;align-items:flex-start;margin:1.5rem 0;padding:1.4em 1em;border-radius:10px;background:#fff6e4;color:rgba(0,0,0,.65);font-size:.94em;line-height:1.6}.znc aside.msg.alert{background:#ffeff2}.znc aside.msg a{color:inherit;text-decoration:underline}.znc .msg-icon{position:relative;top:.05em;width:1.4em;height:1.4em;color:#ffb84c}.znc aside.msg.alert .msg-icon{color:#ff7670}.znc .msg-content{flex:1;margin-left:.6em}.znc .msg-content>*{margin:.7rem 0}.znc .msg-content>*:first-child,.znc .msg-content>*:last-child{margin:0}.znc .footnotes{margin-top:3rem;color:#77838c;font-size:.9em}.znc .footnotes li::marker{color:#77838c}.znc .footnotes-title{padding-bottom:3px;border-bottom:solid 1px #cfdce6;font-weight:700;font-size:15px}.znc .footnotes-list{margin:13px 0 0}.znc .footnotes-twemoji{border:none;margin:0 7px 0 0;vertical-align:-3px}

svg {
  width: 20px;
}
</style>
<div class="znc">
  <hr>
<h2 id="title%3A-%22(%E4%BB%AE)-nextjs-%E3%83%A2%E3%83%8E%E3%83%AC%E3%83%9D%E9%81%8B%E7%94%A8%22emoji%3A-%22%F0%9F%92%AC%22type%3A-%22tech%22-%23-tech%3A-%E6%8A%80%E8%A1%93%E8%A8%98%E4%BA%8B-%2F-idea%3A-%E3%82%A2%E3%82%A4%E3%83%87%E3%82%A2topics%3A-%5B%22nextjs%22%2C-%22serverless%22%2C-%22monorepo%22%5Dpublished%3A-true"><a class="header-anchor-link" href="#title%3A-%22(%E4%BB%AE)-nextjs-%E3%83%A2%E3%83%8E%E3%83%AC%E3%83%9D%E9%81%8B%E7%94%A8%22emoji%3A-%22%F0%9F%92%AC%22type%3A-%22tech%22-%23-tech%3A-%E6%8A%80%E8%A1%93%E8%A8%98%E4%BA%8B-%2F-idea%3A-%E3%82%A2%E3%82%A4%E3%83%87%E3%82%A2topics%3A-%5B%22nextjs%22%2C-%22serverless%22%2C-%22monorepo%22%5Dpublished%3A-true" aria-hidden="true"></a> title: &quot;(仮) NextJS モノレポ運用&quot;<br>
emoji: &quot;💬&quot;<br>
type: &quot;tech&quot; # tech: 技術記事 / idea: アイデア<br>
topics: [&quot;nextjs&quot;, &quot;serverless&quot;, &quot;monorepo&quot;]<br>
published: true</h2>
<p>これは <a href="https://qiita.com/advent-calendar/2021/lancers" target="_blank" rel="nofollow noopener noreferrer">ランサーズ Advent Calendar 2021</a> 4 日目の記事です。</p>
<p>個人の開発では1レポジトリで完結するようなプロジェクトをよく作成します。</p>
<p>ただし実際の事業はスケールしたり、プロジェクトの中でも他のプロジェクトにも共有したいリソースというのは出るものなので初期段階でもしっかりとした基盤を事前に用意したいと思ったので作成しました。</p>
<h2 id="%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E6%A7%8B%E6%88%90"><a class="header-anchor-link" href="#%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E6%A7%8B%E6%88%90" aria-hidden="true"></a> プロジェクト構成</h2>
<ul>
<li>ルートプロジェクト: <a href="https://github.com/igara/syonet_eight" target="_blank" rel="nofollow noopener noreferrer">syonet_eight</a>
<ul>
<li>サブプロジェクト(<a href="https://github.com/igara/syonet_eight/tree/master/projects" target="_blank" rel="nofollow noopener noreferrer">projects</a>)
<ul>
<li><a href="https://github.com/igara/syonet_eight_www" target="_blank" rel="nofollow noopener noreferrer">syonet_eight_www</a></li>
<li><a href="https://github.com/igara/syonet_eight_design_system" target="_blank" rel="nofollow noopener noreferrer">syonet_eight_design_system</a></li>
<li><a href="https://github.com/igara/syonet_eight/tree/master/projects/syonet_eight_storybook" target="_blank" rel="nofollow noopener noreferrer">syonet_eight_storybook</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>上記のようなルートプロジェクトにサブプロジェクトを <code>git submodule</code> で分割して管理しているような構成にしてます。<br>
基本はGitなので対象のサブプロジェクト同士で異なるブランチでの検証も可能だったりします。<br>
一部 <code>git submodule</code>管理されていないサブプロジェクトもありますが。</p>
<p>次にそれぞれのプロジェクトの説明に入ります。</p>
<h3 id="%E3%83%AB%E3%83%BC%E3%83%88%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%3A-syonet_eight"><a class="header-anchor-link" href="#%E3%83%AB%E3%83%BC%E3%83%88%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%3A-syonet_eight" aria-hidden="true"></a> ルートプロジェクト: <a href="https://github.com/igara/syonet_eight" target="_blank" rel="nofollow noopener noreferrer">syonet_eight</a></h3>
<p>サブプロジェクトよりも上の階層にある大元のプロジェクトになります。</p>
<h4 id="yarn-workspace"><a class="header-anchor-link" href="#yarn-workspace" aria-hidden="true"></a> yarn workspace</h4>
<p>NodeJSのライブラリをルートプロジェクトに集中管理し、 <code>yarn workspace</code> によるモノレポな環境にしています。<br>
ルートプロジェクトにライブラリ管理を集中化させてしまってますが、サブプロジェクト側のpackage.jsonにバージョンの異なるライブラリを管理させたり、部分的に使用したいライブラリの管理ができるようになっているんじゃないかなと思います。</p>
<p><code>npm scripts</code> などもルートプロジェクトで管理するようにしてますので基本、CLIのカレントはルートプロジェクトのままで作業することになります。</p>
<h4 id="vscode%E3%81%AE%E8%A8%AD%E5%AE%9A%E3%81%AE%E5%85%B1%E6%9C%89%E5%8C%96"><a class="header-anchor-link" href="#vscode%E3%81%AE%E8%A8%AD%E5%AE%9A%E3%81%AE%E5%85%B1%E6%9C%89%E5%8C%96" aria-hidden="true"></a> VSCodeの設定の共有化</h4>
<p><a href="https://github.com/igara/syonet_eight/tree/master/.vscode" target="_blank" rel="nofollow noopener noreferrer">.vscode</a>をルートプロジェクトに置くことでサブプロジェクトでも自動にVSCodeの設定が適応されます。</p>
<p>以下設置しているファイルを箇条書きで説明します。</p>
<ul>
<li><a href="https://github.com/igara/syonet_eight/blob/master/.vscode/extensions.json" target="_blank" rel="nofollow noopener noreferrer">extensions.json</a><br>
使用するVSCode拡張の共有<br>
VSCodeを開いたときに推奨の拡張とかサジェストの表記がされるようになると思います。</li>
<li><a href="https://github.com/igara/syonet_eight/blob/master/.vscode/launch.json" target="_blank" rel="nofollow noopener noreferrer">launch.json</a><br>
デバッグの設定を記載<br>
プロジェクトごとのリモートデバッグによるポートの専有とか防げるんじゃないでしょうか。</li>
<li><a href="https://github.com/igara/syonet_eight/blob/master/.vscode/settings.json" target="_blank" rel="nofollow noopener noreferrer">settings.json</a><br>
エディターの設定<br>
ESLintの有効化や保存時のフォーマッタ設定<br>
その他モラル的な基本設定とか入れればいいんじゃないでしょうか。</li>
<li><a href="https://github.com/igara/syonet_eight/blob/master/.vscode/sytled-jsx.code-snippets" target="_blank" rel="nofollow noopener noreferrer">xxxxx.code-snippets</a><br>
プロジェクトまたがってコピペ的に使いたいの記載すればいいんじゃないでしょうか。</li>
</ul>
<h4 id="%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%82%92%E3%81%BE%E3%81%9F%E3%81%8C%E3%81%A3%E3%81%9Fstorybook%E3%81%AE%E5%B1%95%E9%96%8B"><a class="header-anchor-link" href="#%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%82%92%E3%81%BE%E3%81%9F%E3%81%8C%E3%81%A3%E3%81%9Fstorybook%E3%81%AE%E5%B1%95%E9%96%8B" aria-hidden="true"></a> プロジェクトをまたがった<a href="https://storybook.js.org/" target="_blank" rel="nofollow noopener noreferrer">Storybook</a>の展開</h4>
<p>設定について<a href="https://github.com/igara/syonet_eight/tree/master/.storybook" target="_blank" rel="nofollow noopener noreferrer">こちら</a>になります。</p>
<p><code>yarn storybook</code> によりコンポーネントのカタログのようなものを閲覧できます。</p>
<p>サブプロジェクトにある <code>xxx.stories.mdx</code> を元に作成されます。</p>
<p><img src="/images/monorepo_nextjs/storybook_props.jpg" alt="storybook_props"></p>
<p>軽くコンポーネントのPropsの検証ができたり</p>
<p><img src="/images/monorepo_nextjs/storybook_accessibility.jpg" alt="storybook_accessibility"></p>
<p>使用しているタグなど実装に関してのアクセシビリティが適切そうかチェックしたり</p>
<p><img src="/images/monorepo_nextjs/storybook_performance.jpg" alt="storybook_performance"></p>
<p>レンダリングのパフォーマンス確認などできるようにしています</p>
<h4 id="ci%E3%81%AE%E3%82%B9%E3%82%B1%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%81%AB%E3%82%88%E3%82%8B%E5%85%A8%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AEut%E5%AE%9F%E8%A1%8C"><a class="header-anchor-link" href="#ci%E3%81%AE%E3%82%B9%E3%82%B1%E3%82%B8%E3%83%A5%E3%83%BC%E3%83%AB%E3%81%AB%E3%82%88%E3%82%8B%E5%85%A8%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AEut%E5%AE%9F%E8%A1%8C" aria-hidden="true"></a> CIのスケジュールによる全プロジェクトのUT実行</h4>
<p>設定について<a href="https://github.com/igara/syonet_eight/blob/master/.github/workflows/root.yml" target="_blank" rel="nofollow noopener noreferrer">こちら</a></p>
<p>それぞれのサブプロジェクトの最新のmasterブランチを持ってきてlint, jestによるテスト実行をするようにしてます。</p>
<p>サブプロジェクト側でも個別にGitHub Actionsによるワークフローを記載しているのでそれぞれのレポジトリのプッシュでもテスト実行するようにしています。</p>
<h3 id="%E3%82%B5%E3%83%96%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%3A-syonet_eight_www"><a class="header-anchor-link" href="#%E3%82%B5%E3%83%96%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%3A-syonet_eight_www" aria-hidden="true"></a> サブプロジェクト: <a href="https://github.com/igara/syonet_eight_www" target="_blank" rel="nofollow noopener noreferrer">syonet_eight_www</a></h3>
<p>NextJSによるプロジェクトになります。</p>
<h4 id="serverless-next.js-component%E3%81%AB%E3%82%88%E3%82%8B%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4"><a class="header-anchor-link" href="#serverless-next.js-component%E3%81%AB%E3%82%88%E3%82%8B%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4" aria-hidden="true"></a> <a href="https://www.serverless.com/plugins/serverless-nextjs-plugin" target="_blank" rel="nofollow noopener noreferrer">Serverless Next.js Component</a>によるデプロイ</h4>
<p>NextJSの本家<a href="https://vercel.com" target="_blank" rel="nofollow noopener noreferrer">Vercel</a> でもいいんですけどAWSにデプロイ可能な<a href="https://www.serverless.com/" target="_blank" rel="nofollow noopener noreferrer">Serverless Framework</a>を採用しています。</p>
<p>デプロイの仕組みの説明難しいですが <a href="https://github.com/igara/syonet_eight_www/blob/master/serverless.yml" target="_blank" rel="nofollow noopener noreferrer">serverless.yml</a> の情報がAWSのCloudFormationのテンプレートとして展開されてAWSのそれぞれのサービスをよしなに使って1つのWebサービスを作ってしまうというものです。</p>
<p>下記の図はデプロイで反映するAWSのサービスのイメージになります。</p>
<p><img src="/images/monorepo_nextjs/serverless_nextjs.drawio.png" alt="serverless_nextjs"></p>
<p>それぞれのAWSのサービスが外部のユーザから見てどう使われているのかのイメージを記載すると</p>
<p><img src="/images/monorepo_nextjs/serverless_service.drawio.png" alt="serverless_service"></p>
<p>なのをServerless Next.js Componentで再現できちゃうらしいです。<br>
SPA想定だったReactの資産をフル活用できますね。</p>
<h3 id="%E3%82%B5%E3%83%96%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%3A-syonet_eight_design_system"><a class="header-anchor-link" href="#%E3%82%B5%E3%83%96%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%3A-syonet_eight_design_system" aria-hidden="true"></a> サブプロジェクト: <a href="https://github.com/igara/syonet_eight_design_system" target="_blank" rel="nofollow noopener noreferrer">syonet_eight_design_system</a></h3>
<p>共通のデザインなどをまとめるプロジェクトです。</p>
<h4 id="%E5%85%B1%E9%80%9A%E3%82%B3%E3%83%B3%E3%83%9D%E3%83%BC%E3%83%8D%E3%83%B3%E3%83%88%E3%82%92%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E5%8C%96"><a class="header-anchor-link" href="#%E5%85%B1%E9%80%9A%E3%82%B3%E3%83%B3%E3%83%9D%E3%83%BC%E3%83%8D%E3%83%B3%E3%83%88%E3%82%92%E3%83%A9%E3%82%A4%E3%83%96%E3%83%A9%E3%83%AA%E5%8C%96" aria-hidden="true"></a> 共通コンポーネントをライブラリ化</h4>
<p><code>yarn build:design_system</code> を実行することでライブラリ化します。</p>
<p>ルートプロジェクトの<a href="https://github.com/igara/syonet_eight/blob/master/package.json" target="_blank" rel="nofollow noopener noreferrer">package.json</a>にある</p>
<div class="code-block-container"><pre class=""><code class="">&quot;syonet_eight_design_system&quot;: &quot;file:./projects/syonet_eight_design_system&quot;
</code></pre></div><p>という指定により別のサブプロジェクトでも</p>
<div class="code-block-container"><pre class=""><code class="">import * as DesignSystem from 'syonet_eight_design_system';
</code></pre></div><p>で共通のコンポーネントを使用することが可能です。</p>
<h4 id="figma%E3%81%A7%E4%BD%9C%E6%88%90%E3%81%97%E3%81%9F%E3%83%91%E3%83%BC%E3%83%84%E3%81%AE%E3%82%A4%E3%83%B3%E3%83%9D%E3%83%BC%E3%83%88"><a class="header-anchor-link" href="#figma%E3%81%A7%E4%BD%9C%E6%88%90%E3%81%97%E3%81%9F%E3%83%91%E3%83%BC%E3%83%84%E3%81%AE%E3%82%A4%E3%83%B3%E3%83%9D%E3%83%BC%E3%83%88" aria-hidden="true"></a> Figmaで作成したパーツのインポート</h4>
<p><code>yarn import:figma</code> でFigmaで作成したものをインポートするような仕組みを作ってます。</p>
<p>実装したコードはこちらです</p>
<p><div class="embed-zenn-link"><iframe src="https://card.zenn.dev/?url=https%3A%2F%2Fgithub.com%2Figara%2Fsyonet_eight_design_system%2Fblob%2Fmaster%2Fsrc%2Fscripts%2Ffigma.ts" frameborder="0" scrolling="no" loading="lazy"></iframe></div><a href="https://github.com/igara/syonet_eight_design_system/blob/master/src/scripts/figma.ts" style="display: none" target="_blank" rel="nofollow noopener noreferrer">https://github.com/igara/syonet_eight_design_system/blob/master/src/scripts/figma.ts</a></p>
<p>SVG化して使うのは結構安易そうですが、DOMとして扱うのは難しめにみてます。<br>
(だってあいつらNodeIDの順番とか位置関係ようわからんし)</p>
<h4 id="%E3%83%93%E3%83%AB%E3%83%89%E3%81%AE%E8%A8%AD%E5%AE%9Anextjs%E3%81%AE%E3%82%92%E3%81%9D%E3%81%AE%E3%81%BE%E3%81%BE%E3%81%A4%E3%81%8B%E3%81%A3%E3%81%A6%E3%82%8B"><a class="header-anchor-link" href="#%E3%83%93%E3%83%AB%E3%83%89%E3%81%AE%E8%A8%AD%E5%AE%9Anextjs%E3%81%AE%E3%82%92%E3%81%9D%E3%81%AE%E3%81%BE%E3%81%BE%E3%81%A4%E3%81%8B%E3%81%A3%E3%81%A6%E3%82%8B" aria-hidden="true"></a> ビルドの設定NextJSのをそのままつかってる</h4>
<p><a href="https://github.com/igara/syonet_eight_design_system/blob/master/tsconfig.json" target="_blank" rel="nofollow noopener noreferrer">tsconfig.json</a>とか<a href="https://github.com/igara/syonet_eight_design_system/blob/master/.babelrc" target="_blank" rel="nofollow noopener noreferrer">.babelrc</a>の設定はNextJSで動かしていたものを使用してます。</p>
<aside class="msg message"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 101 101" role="img" aria-label="message" class="msg-icon"><circle cx="51" cy="51" r="50" fill="currentColor"></circle><text x="50%" y="50%" text-anchor="middle" fill="#ffffff" font-size="70" font-weight="bold" dominant-baseline="central">!</text></svg><div class="msg-content"><p>その弊害で<a href="https://github.com/igara/syonet_eight_design_system/tree/master/pages" target="_blank" rel="nofollow noopener noreferrer">pages</a>ディレクトリがないとビルドに失敗してしまうので追加してます。<br>
ものすごくこのディレクトリ消したいんですよね</p>
</div></aside>
<h3 id="syonet_eight_www-%26-syonet_eight_design_system-%E5%85%B1%E9%80%9A%E3%81%AE%E5%8F%96%E3%82%8A%E7%B5%84%E3%81%BF"><a class="header-anchor-link" href="#syonet_eight_www-%26-syonet_eight_design_system-%E5%85%B1%E9%80%9A%E3%81%AE%E5%8F%96%E3%82%8A%E7%B5%84%E3%81%BF" aria-hidden="true"></a> <a href="https://github.com/igara/syonet_eight_www" target="_blank" rel="nofollow noopener noreferrer">syonet_eight_www</a> &amp; <a href="https://github.com/igara/syonet_eight_design_system" target="_blank" rel="nofollow noopener noreferrer">syonet_eight_design_system</a> 共通の取り組み</h3>
<h4 id="%E3%83%93%E3%82%B8%E3%83%A5%E3%82%A2%E3%83%AB%E3%83%AA%E3%82%B0%E3%83%AC%E3%83%83%E3%82%B7%E3%83%A7%E3%83%B3%E3%83%86%E3%82%B9%E3%83%88%E5%AE%9F%E6%96%BD"><a class="header-anchor-link" href="#%E3%83%93%E3%82%B8%E3%83%A5%E3%82%A2%E3%83%AB%E3%83%AA%E3%82%B0%E3%83%AC%E3%83%83%E3%82%B7%E3%83%A7%E3%83%B3%E3%83%86%E3%82%B9%E3%83%88%E5%AE%9F%E6%96%BD" aria-hidden="true"></a> ビジュアルリグレッションテスト実施</h4>
<p><a href="https://reg-viz.github.io/reg-suit/" target="_blank" rel="nofollow noopener noreferrer">reg-suit</a>というGitのプッシュを実行した際にコンポーネントの差分をビジュアライズする仕組みを入れてます。</p>
<p>例えばこんな差分があったときに</p>
<p><div class="embed-zenn-link"><iframe src="https://card.zenn.dev/?url=https%3A%2F%2Fgithub.com%2Figara%2Fsyonet_eight_design_system%2Fcommit%2Fbf6de6cbd274e239e73f4eb39391bd9b060cb74b" frameborder="0" scrolling="no" loading="lazy"></iframe></div><a href="https://github.com/igara/syonet_eight_design_system/commit/bf6de6cbd274e239e73f4eb39391bd9b060cb74b" style="display: none" target="_blank" rel="nofollow noopener noreferrer">https://github.com/igara/syonet_eight_design_system/commit/bf6de6cbd274e239e73f4eb39391bd9b060cb74b</a></p>
<p>差分としての検知として</p>
<p><img src="/images/monorepo_nextjs/reg_suit_top.jpg" alt="reg_suit_top"></p>
<p>一覧が表示されて詳細をみようとすると</p>
<p><img src="/images/monorepo_nextjs/reg_suit_diff.gif" alt="reg_suit_diff"></p>
<p>どのへんに差分があるのかというのをビジュアライズしてくれます。</p>
<p>CIの設定としてこちらになります。</p>
<p><div class="embed-zenn-link"><iframe src="https://card.zenn.dev/?url=https%3A%2F%2Fgithub.com%2Figara%2Fsyonet_eight_design_system%2Fblob%2Fmaster%2F.github%2Fworkflows%2Fvrt.yml" frameborder="0" scrolling="no" loading="lazy"></iframe></div><a href="https://github.com/igara/syonet_eight_design_system/blob/master/.github/workflows/vrt.yml" style="display: none" target="_blank" rel="nofollow noopener noreferrer">https://github.com/igara/syonet_eight_design_system/blob/master/.github/workflows/vrt.yml</a></p>
<p>GitHub Actions上では日本語フォントがないので <code>fonts-noto</code> をインストールする必要があったりします。</p>
<p>あとはこちらのテストの結果は現状Slackで通知がくることを確認しています。</p>
<p><img src="/images/monorepo_nextjs/slack.png" alt="slack"></p>
<aside class="msg message"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 101 101" role="img" aria-label="message" class="msg-icon"><circle cx="51" cy="51" r="50" fill="currentColor"></circle><text x="50%" y="50%" text-anchor="middle" fill="#ffffff" font-size="70" font-weight="bold" dominant-baseline="central">!</text></svg><div class="msg-content"><p>GitHubのPRに対してテスト結果をコメントしてくれる機能もありますがこれに関しては正常に動作してません...</p>
</div></aside>
<h4 id="css-in-js%E3%81%A8%E3%81%97%E3%81%A6emotion%E6%8E%A1%E7%94%A8"><a class="header-anchor-link" href="#css-in-js%E3%81%A8%E3%81%97%E3%81%A6emotion%E6%8E%A1%E7%94%A8" aria-hidden="true"></a> CSS in JSとしてemotion採用</h4>
<p>好みですが、</p>
<div class="code-block-container"><pre class=""><code class="">import { css } from '@emotion/react';
</code></pre></div><p>で<a href="https://github.com/css-modules/css-modules" target="_blank" rel="nofollow noopener noreferrer">CSS Modules</a>ぽくもpropsでCSSの値指定できるようないいとこ取りな書き方よくないっすか？</p>
<p><div class="embed-zenn-link"><iframe src="https://card.zenn.dev/?url=https%3A%2F%2Fgithub.com%2Figara%2Fsyonet_eight_design_system%2Fblob%2Fmaster%2Fsrc%2Fcomponents%2Ficons%2Fmenu_icon%2Fmenu_icon.styles.ts" frameborder="0" scrolling="no" loading="lazy"></iframe></div><a href="https://github.com/igara/syonet_eight_design_system/blob/master/src/components/icons/menu_icon/menu_icon.styles.ts" style="display: none" target="_blank" rel="nofollow noopener noreferrer">https://github.com/igara/syonet_eight_design_system/blob/master/src/components/icons/menu_icon/menu_icon.styles.ts</a><br style="display: none">
<div class="embed-zenn-link"><iframe src="https://card.zenn.dev/?url=https%3A%2F%2Fgithub.com%2Figara%2Fsyonet_eight_design_system%2Fblob%2Fmaster%2Fsrc%2Fcomponents%2Ficons%2Fmenu_icon%2Fmenu_icon.tsx" frameborder="0" scrolling="no" loading="lazy"></iframe></div><a href="https://github.com/igara/syonet_eight_design_system/blob/master/src/components/icons/menu_icon/menu_icon.tsx" style="display: none" target="_blank" rel="nofollow noopener noreferrer">https://github.com/igara/syonet_eight_design_system/blob/master/src/components/icons/menu_icon/menu_icon.tsx</a></p>
<h3 id="%E3%82%B5%E3%83%96%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%3A-syonet_eight_storybook"><a class="header-anchor-link" href="#%E3%82%B5%E3%83%96%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%3A-syonet_eight_storybook" aria-hidden="true"></a> サブプロジェクト: <a href="https://github.com/igara/syonet_eight/tree/master/projects/syonet_eight_storybook" target="_blank" rel="nofollow noopener noreferrer">syonet_eight_storybook</a></h3>
<p>Storybookを配布するように<a href="https://github.com/igara/syonet_eight/blob/master/projects/syonet_eight_storybook/serverless.yml" target="_blank" rel="nofollow noopener noreferrer">serverless.yml</a>しか置いてないです。</p>
<p>これもServerless Frameworkのコンポーネントをつかっており、<a href="https://github.com/serverless-components/website" target="_blank" rel="nofollow noopener noreferrer">website</a>というものを使っています。</p>
<p>ただのSPAのサイトをホスティングしたい用途で使うのがちょうど良さそうです。</p>
<h2 id="%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB"><a class="header-anchor-link" href="#%E3%81%8A%E3%82%8F%E3%82%8A%E3%81%AB" aria-hidden="true"></a> おわりに</h2>
<p>以上自分なりのモノレポ運用についての記載でした。</p>
<p>まだ実装そのものを着手してなく、APIのプロジェクトも作成していない状況なのでこれからすすめていきたいと思います。</p>
<p>アドベントカレンダー、明日は <a href="https://qiita.com/yuta-ron" target="_blank" rel="nofollow noopener noreferrer">@yuta-ron</a> さんです。<br>
よろしくおねがいします。</p>

</div>